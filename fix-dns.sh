#!/bin/bash

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS –ø—Ä–æ–±–ª–µ–º—ã..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π DNS
echo "üìä –¢–µ–∫—É—â–∏–π DNS —Å–µ—Ä–≤–µ—Ä:"
resolvectl status | grep "Current DNS Server" || echo "DNS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"

# –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º DNS –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ DNS –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker stop base-dns-1 2>/dev/null || echo "DNS –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

# –°–±—Ä–∞—Å—ã–≤–∞–µ–º DNS –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π
echo "üîÑ –°–±—Ä–æ—Å DNS –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π..."
sudo systemctl restart systemd-resolved

# –ñ–¥–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
sleep 3

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–π DNS
echo "üìä –ù–æ–≤—ã–π DNS —Å–µ—Ä–≤–µ—Ä:"
resolvectl status | grep "Current DNS Server" || echo "DNS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
echo "üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞..."
if ping -c 1 8.8.8.8 > /dev/null 2>&1; then
    echo "‚úÖ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç (8.8.8.8 –¥–æ—Å—Ç—É–ø–µ–Ω)"
else
    echo "‚ùå –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

if ping -c 1 google.com > /dev/null 2>&1; then
    echo "‚úÖ DNS —Ä–∞–±–æ—Ç–∞–µ—Ç (google.com —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è)"
else
    echo "‚ùå DNS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

echo ""
echo "üí° –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å WebStream –ø—Ä–æ–µ–∫—Ç:"
echo "   ./start-safe.sh"
echo ""
echo "‚ö†Ô∏è  –í–ê–ñ–ù–û: –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ base-dns-1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –ø–æ–∫–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç–µ —Ä–∞–±–æ—Ç—É —Å WebStream!"

